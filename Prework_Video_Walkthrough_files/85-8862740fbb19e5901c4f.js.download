(self.webpackChunk_loomhq_web_client=self.webpackChunk_loomhq_web_client||[]).push([[85],{14261:(e,r,n)=>{"use strict";n.d(r,{i:()=>t});var a,t=((a=t||{}).NOT_STARTED="not-started",a.STARTED="started",a.FINISHED="finished",a)},17221:(e,r,n)=>{"use strict";n.d(r,{b:()=>s});var a=n(17073),t=n(99148),i=n(8672);function s(e){return i.createElement(i.Fragment,null,i.createElement("svg",(0,a.k)((0,a.I)({viewBox:"0 0 24 24",fill:"none"},e),{className:"lens-legacy-icon"}),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.707 5.293a1 1 0 010 1.414l-11 11a1 1 0 01-1.414 0l-5-5a1 1 0 111.414-1.414L9 15.586 19.293 5.293a1 1 0 011.414 0z",fill:"currentColor"})),i.createElement(t.A,{label:""}))}},36424:(e,r,n)=>{"use strict";n.d(r,{Co:()=>f,Y8:()=>A,Ay:()=>$,X1:()=>R,mu:()=>M,jy:()=>O,R8:()=>V,LI:()=>x,j$:()=>L,oN:()=>F});var a=n(59599),t=n(36936),i=n(55044),s=n(92947),o=n(21262),c=n(99880),l=n(31924),d=n(41884),u=n.n(d),p=n(77847),m=n.n(p);let v=(e,r)=>(0,l.Xc)().mutate({mutation:u(),variables:{...e,password:r}}),h=(e,r)=>(0,l.Xc)().mutate({mutation:m(),variables:{videoId:e,password:r}}),f="correction-popup-anchor",k={correctionsEnabled:!0,editedRowIndex:-1,hoveredRowIndex:-1,isPopupOpen:!1,localCorrections:[],selectedElementSource:null,selectedOccurrenceIndex:-1,textToCorrect:"",transcript:null,transcriptCorrectionMessage:null,transcriptWithLocalCorrections:null},g=(e,r)=>e.element===r.element&&e.monologue===r.monologue,S=(e,r,n,a)=>e.substr(0,r.start+a)+n+e.substr(r.start+a+r.length),b=(e,r,n)=>{let a=[];for(let r=0;r<n;r++)a.push({...e[r]});let t=n+1;r.length>0&&a.push({...e[n],length:r.length});let i=r.length-e[n].length;for(let r=t;r<e.length;r++){let n=e[r];a.push({...n,start:n.start+i})}return a},N=(e,r)=>({phrases:e.phrases.map(e=>{let n=0,a={...e};return e.ranges?.forEach((e,t)=>{let i=r.find(r=>r.sources.some(r=>g(r,e.source)));if(i){let r=i.newValue;a.value=S(a.value,e,r,n),a.ranges=b(a.ranges,r,t),n+=r.length-e.length}}),a}),schemaVersion:e.schemaVersion}),w=(0,a.Z0)({name:"transcription",initialState:k,reducers:{pushLocalCorrections(e,r){e.localCorrections.push(r.payload),e.transcriptWithLocalCorrections=N((0,t.ss)(e.transcript),r.payload)},startLongProcess(e){e.correctionsEnabled=!1},endLongProcess(e){e.correctionsEnabled=!0},updateTranscriptPhrases(e,r){e.transcript=r.payload,e.localCorrections=[],e.transcriptWithLocalCorrections=e.transcript},updateTranscriptCorrectionMessage(e,r){e.transcriptCorrectionMessage=r.payload},openCorrectionPopup(e,r){e.textToCorrect=r.payload.textToCorrect,e.selectedOccurrenceIndex=r.payload.selectedOccurrenceIndex,e.selectedElementSource=r.payload.selectedElementSource,e.editedRowIndex=r.payload.editedRowIndex,e.isPopupOpen=!0},updateSelectedElementSource(e,r){e.selectedElementSource=r.payload.selectedElementSource},toggleCorrectionPopup(e,r){e.isPopupOpen=r.payload},updateHoveredRowIndex(e,r){e.hoveredRowIndex=r.payload},resetTranscription(e){Object.assign(e,k)}}}),C=(e,r)=>r&&e.value.substring(r.start,r.length+r.start),y=(e,r)=>{let n=C(e,r);return r?.type==="punct"&&" "===n},_=(e,r)=>{let n=C(e,r);return r?.type==="punct"&&[".","!","?"].includes(n)},T=(e,r)=>{let n=C(e,r);return r?.type==="punct"&&","===n},E=(e,r,n,a,...t)=>{if(0===t.length)return;let i=t.map(e=>({...e}));e[n]||(e[n]={newValue:n,sources:[]}),e[n].sources.push(...i),r[a]||(r[a]={newValue:a,sources:[]}),r[a].sources.push(...i)},I=(e,r,n)=>{let a={},t={};for(let i of(E(a,t,"",n,...r.sources),e.phrases))for(let e=0;e<Number(i.ranges?.length);e++){let n=i.ranges?.[e];if(r.sources.some(e=>g(e,n?.source))){let r=0===e,n=[],s=[],o=e-1,c=i.ranges[o],l=e+1,d=i.ranges[l],u=_(i,d);for(;c&&(y(i,c)||T(i,c));)y(i,c)?n.unshift(c):s.unshift(c),c=i.ranges[--o];let p=r||_(i,c);for(;!u&&d&&(y(i,d)||T(i,d));)y(i,d)?n.push(d):s.push(d),d=i.ranges[++l];let m=r||u||0===n.length?0:1,v=p||u||0===s.length?0:1,h=n.slice(m),f=s.slice(v);if(m>0&&v>0){let e=s[0].source.element;if(n[0].source.element<e){for(let[r,a]of n.entries())if(a.source.element>e){n.splice(r,1),h=[...n];break}}}if(E(a,t,""," ",...h.map(e=>e.source)),E(a,t,"",",",...f.map(e=>e.source)),p&&d?.type==="text"){let e=C(i,d),r=e.charAt(0).toUpperCase()+e.substring(1);E(a,t,r,e,d.source)}if(p&&u&&d){let e=C(i,d);E(a,t,"",e,d.source)}}}return{corrections:Object.values(a),reverseCorrections:Object.values(t)}},D=(e,r,n)=>""===r.newValue?I(e,r,n):{corrections:[r],reverseCorrections:[{...r,newValue:n}]},P=async(e,r)=>{let{source_url:n,captions_source_url:a}=r;e((0,c.rU)({captionsSourceUrl:a}));let t=await (0,i.A)(n);if(!t?.ok)throw Error("Failed to fetch transcript json");let s=await t.json();e(F(s))},A=(e,r,n,a)=>async(t,i)=>{let c=i().transcription.transcript,{corrections:l,reverseCorrections:d}=D(c,n,r),u={videoId:e,transcriptCorrections:l};t(w.actions.pushLocalCorrections(u.transcriptCorrections));let p=(await v(u,a))?.data?.updateVideoTranscript;if(p?.message){t(L(p.message.replace(`${s.F3}: `,""))),t(w.actions.pushLocalCorrections(d));return}await P(t,p),t((0,o.gG)(p?.version))},O=e=>async(r,n)=>{let a=n().share_video.password||"";r(w.actions.startLongProcess());try{let n=(await h(e,a))?.data?.revertAllTranscriptCorrections;if(n?.message){r(L(n.message.replace(`${s.tk}: `,"")));return}await P(r,n),r(L("All changes have been undone")),r((0,o.gG)(n?.version))}catch(e){throw r(L("Could not undo changes")),e}finally{r(w.actions.endLongProcess())}},{openCorrectionPopup:R,toggleCorrectionPopup:V,updateHoveredRowIndex:x,updateTranscriptCorrectionMessage:L,updateTranscriptPhrases:F,resetTranscription:M,updateSelectedElementSource:U}=w.actions,$=w.reducer},41884:e=>{var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CorrectWords"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"videoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"transcriptCorrections"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TranscriptionCorrection"}}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"password"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateVideoTranscript"},arguments:[{kind:"Argument",name:{kind:"Name",value:"videoId"},value:{kind:"Variable",name:{kind:"Name",value:"videoId"}}},{kind:"Argument",name:{kind:"Name",value:"transcriptCorrections"},value:{kind:"Variable",name:{kind:"Name",value:"transcriptCorrections"}}},{kind:"Argument",name:{kind:"Name",value:"password"},value:{kind:"Variable",name:{kind:"Name",value:"password"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"video_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"version"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"captions_source_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:326}};r.loc.source={body:"mutation CorrectWords(\n  $videoId: ID!\n  $transcriptCorrections: [TranscriptionCorrection!]!\n  $password: String\n) {\n  updateVideoTranscript(\n    videoId: $videoId\n    transcriptCorrections: $transcriptCorrections\n    password: $password\n  ) {\n    video_id\n    version\n    source_url\n    captions_source_url\n    message\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function a(e,r){for(var n=0;n<e.definitions.length;n++){var a=e.definitions[n];if(a.name&&a.name.value==r)return a}}r.definitions.forEach(function(e){if(e.name){var r=new Set;(function e(r,n){if("FragmentSpread"===r.kind)n.add(r.name.value);else if("VariableDefinition"===r.kind){var a=r.type;"NamedType"===a.kind&&n.add(a.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(r){e(r,n)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(r){e(r,n)}),r.definitions&&r.definitions.forEach(function(r){e(r,n)})})(e,r),n[e.name.value]=r}}),e.exports=r,e.exports.CorrectWords=function(e,r){var t={kind:e.kind,definitions:[a(e,r)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=n[r]||new Set,s=new Set,o=new Set;for(i.forEach(function(e){o.add(e)});o.size>0;){var c=o;o=new Set,c.forEach(function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach(function(e){o.add(e)}))})}return s.forEach(function(r){var n=a(e,r);n&&t.definitions.push(n)}),t}(r,"CorrectWords")},77847:e=>{var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RevertAllCorrections"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"videoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"password"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"revertAllTranscriptCorrections"},arguments:[{kind:"Argument",name:{kind:"Name",value:"videoId"},value:{kind:"Variable",name:{kind:"Name",value:"videoId"}}},{kind:"Argument",name:{kind:"Name",value:"password"},value:{kind:"Variable",name:{kind:"Name",value:"password"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"version"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"captions_source_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:210}};r.loc.source={body:"mutation RevertAllCorrections($videoId: ID!, $password: String) {\n  revertAllTranscriptCorrections(videoId: $videoId, password: $password) {\n    version\n    source_url\n    captions_source_url\n    message\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function a(e,r){for(var n=0;n<e.definitions.length;n++){var a=e.definitions[n];if(a.name&&a.name.value==r)return a}}r.definitions.forEach(function(e){if(e.name){var r=new Set;(function e(r,n){if("FragmentSpread"===r.kind)n.add(r.name.value);else if("VariableDefinition"===r.kind){var a=r.type;"NamedType"===a.kind&&n.add(a.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(r){e(r,n)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(r){e(r,n)}),r.definitions&&r.definitions.forEach(function(r){e(r,n)})})(e,r),n[e.name.value]=r}}),e.exports=r,e.exports.RevertAllCorrections=function(e,r){var t={kind:e.kind,definitions:[a(e,r)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=n[r]||new Set,s=new Set,o=new Set;for(i.forEach(function(e){o.add(e)});o.size>0;){var c=o;o=new Set,c.forEach(function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach(function(e){o.add(e)}))})}return s.forEach(function(r){var n=a(e,r);n&&t.definitions.push(n)}),t}(r,"RevertAllCorrections")},92947:(e,r,n)=>{"use strict";n.d(r,{F3:()=>t,V6:()=>s,tk:()=>i});var a=n(37464);let t="Update Transcript Denied",i="Update Transcript Denied",s="No screenshots match your search",o=class e extends Error{constructor(r,n,...a){super(...a),Error.captureStackTrace&&Error.captureStackTrace(this,e),this.name="ClipUpdateError",this.reason=r,this.message=n}};(0,a.Mu)(o,"REASONS",{CLIPS_NOT_ACCEPTED:"CLIPS_NOT_ACCEPTED",NO_CLIPS:"NO_CLIPS",DUPLICATE_ENTRIES:"DUPLICATE_ENTRIES",BAD_POSITION:"BAD_POSITION",UNMATCHED_CLIP:"UNMATCHED_CLIP",OVER_DURATION:"OVER_DURATION"})},98122:(e,r,n)=>{"use strict";n.d(r,{Ay:()=>l,Jy:()=>o,i4:()=>s});var a=n(63814),t=n(14261);let i={isTranscriptSearchOpen:!1,transcriptSearchPhrase:"",transcriptSearchInputValue:"",transcriptSearchPhraseIndexArray:[],currentSearchIndex:0},s="view",o="correction",c={current_user_is_owner:!1,currentRightPanelTab:null,download_url:null,expandRightPanel:!1,fromRecorder:!1,hasBeenEdited:!1,hasSeenAnonShareGateModal:!1,retranscription_status:t.i.NOT_STARTED,transcript:null,transcript_details:{},transcriptPanelMode:s,transcriptSearch:{...i},userClickedNavToggle:!1},l=(e=c,r)=>{let n=e,t=null;switch(r.type){case a.fE:n={...e,download_url:r.downloadUrl};break;case a.Cd:n={...e,hasBeenEdited:r.hasBeenEdited};break;case a.Cw:t=r.video,n={...e,current_user_is_owner:t.current_user_is_owner,visibility:t.visibility};break;case a.gs:n={...e,transcript_details:r.transcriptDetails};break;case a.EX:n={...e,transcript_details:{...e.transcript_details,version:r.version}};break;case a.kc:n={...e,transcript_details:{...e.transcript_details,transcription_status:r.status}};break;case a.pj:n={...e,retranscription_status:r.status};break;case a.q_:n={...e,fromRecorder:r.fromRecorder};break;case a.Gs:n={...e,expandRightPanel:r.expandRightPanel};break;case a.pd:n={...e,transcriptSearch:{...i,isTranscriptSearchOpen:r.isTranscriptSearchOpen}};break;case a.on:n={...e,transcriptSearch:{...e.transcriptSearch,transcriptSearchPhrase:r.transcriptSearchPhrase}};break;case a.Xd:n={...e,transcriptSearch:{...e.transcriptSearch,transcriptSearchInputValue:r.transcriptSearchInputValue}};break;case a.bf:n={...e,transcriptSearch:{...e.transcriptSearch,transcriptSearchPhraseIndexArray:r.transcriptSearchPhraseIndexArray}};break;case a.Mt:n={...e,transcriptSearch:{...e.transcriptSearch,currentSearchIndex:r.currentSearchIndex}};break;case a.IR:n={...e,transcriptPanelMode:r.transcriptPanelMode};break;case a.kQ:n={...e,hasSeenAnonShareGateModal:r.payload};break;case a.e7:n={...e,currentRightPanelTab:r.currentRightPanelTab};break;case a.rw:n={...e,userClickedNavToggle:!0};break;case a.w8:n={...e,showDefaultSettings:r.showDefaultSettings};break;default:n=e}return n}}}]);
//# sourceMappingURL=https://www.loom.com/admin/sourcemaps/js/85-8862740fbb19e5901c4f.js.map